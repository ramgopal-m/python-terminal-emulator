<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Terminal Emulator - SRM Hacks with CodeMate</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Courier New", monospace;
        background: #1a1a1a;
        color: #00ff00;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: #2d2d2d;
        padding: 10px 20px;
        border-bottom: 1px solid #444;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        color: #00ff00;
        font-size: 18px;
      }

      .header .info {
        color: #888;
        font-size: 12px;
      }

      .terminal-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 20px;
        overflow: hidden;
      }

      .terminal {
        flex: 1;
        background: #000;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 15px;
        overflow-y: auto;
        font-size: 14px;
        line-height: 1.4;
      }

      .input-line {
        display: flex;
        align-items: center;
        margin-top: 10px;
      }

      .prompt {
        color: #00ff00;
        margin-right: 10px;
      }

      .command-input {
        flex: 1;
        background: transparent;
        border: none;
        color: #00ff00;
        font-family: inherit;
        font-size: inherit;
        outline: none;
      }

      .output {
        white-space: pre-wrap;
        margin: 5px 0;
      }

      .error {
        color: #ff6b6b;
      }

      .success {
        color: #51cf66;
      }

      .info {
        color: #74c0fc;
      }

      .cursor {
        animation: blink 1s infinite;
      }

      @keyframes blink {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0;
        }
      }

      .welcome {
        color: #ffd43b;
        text-align: center;
        margin-bottom: 20px;
        padding: 10px;
        border: 1px solid #444;
        border-radius: 5px;
        background: #2d2d2d;
      }

      .help-panel {
        background: #2d2d2d;
        border: 1px solid #444;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        max-height: 200px;
        overflow-y: auto;
      }

      .help-panel h3 {
        color: #ffd43b;
        margin-bottom: 10px;
      }

      .help-panel .command {
        color: #74c0fc;
        margin-right: 10px;
      }

      .loading {
        color: #ffd43b;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üöÄ Python Terminal Emulator</h1>
      <div class="info">SRM Hacks with CodeMate | Built by Ramgopal M</div>
    </div>

    <div class="terminal-container">
      <div class="welcome">
        <h2>üéØ Welcome to Python Terminal Emulator</h2>
        <p>
          A fully functional terminal built for SRM Hacks with CodeMate
          competition
        </p>
        <p>Type <strong>'help'</strong> to see available commands</p>
      </div>

      <div class="help-panel">
        <h3>üîß Quick Commands</h3>
        <div>
          <span class="command">ls</span> - List files |
          <span class="command">cd</span> - Change directory |
          <span class="command">pwd</span> - Current directory
        </div>
        <div>
          <span class="command">mkdir</span> - Create folder |
          <span class="command">touch</span> - Create file |
          <span class="command">cat</span> - Read file
        </div>
        <div>
          <span class="command">ps</span> - Processes |
          <span class="command">top</span> - System info |
          <span class="command">help</span> - All commands
        </div>
      </div>

      <div class="terminal" id="terminal">
        <div class="output info">
          üéÆ Python Terminal Emulator v1.0 - Web Edition üíª Built for SRM Hacks
          with CodeMate Competition üìç Current Directory: /home/user üöÄ Ready
          for commands! Type 'help' for available commands.
        </div>
      </div>

      <div class="input-line">
        <span class="prompt">terminal@web:~$</span>
        <input
          type="text"
          class="command-input"
          id="commandInput"
          placeholder="Type your command here..."
        />
        <span class="cursor">|</span>
      </div>
    </div>

    <script>
      class WebTerminal {
        constructor() {
          this.terminal = document.getElementById("terminal");
          this.input = document.getElementById("commandInput");
          this.currentDir = "/home/user";
          this.history = [];
          this.historyIndex = -1;

          this.setupEventListeners();
          this.initializeFileSystem();
        }

        setupEventListeners() {
          this.input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
              this.executeCommand();
            } else if (e.key === "ArrowUp") {
              e.preventDefault();
              this.navigateHistory(-1);
            } else if (e.key === "ArrowDown") {
              e.preventDefault();
              this.navigateHistory(1);
            }
          });

          // Keep input focused
          this.input.focus();
          document.addEventListener("click", () => this.input.focus());
        }

        initializeFileSystem() {
          this.fileSystem = {
            "/home/user": {
              type: "directory",
              contents: {
                documents: {
                  type: "directory",
                  contents: {
                    "readme.txt": {
                      type: "file",
                      content:
                        "Welcome to Python Terminal Emulator!\nBuilt for SRM Hacks with CodeMate.",
                    },
                    "project.py": {
                      type: "file",
                      content:
                        '# Python Terminal Emulator\nprint("Hello from terminal!")',
                    },
                  },
                },
                downloads: { type: "directory", contents: {} },
                "demo.txt": {
                  type: "file",
                  content:
                    "This is a demo file created by the terminal emulator.",
                },
              },
            },
          };
        }

        executeCommand() {
          const command = this.input.value.trim();
          if (!command) return;

          // Add to history
          this.history.push(command);
          this.historyIndex = this.history.length;

          // Display command
          this.addOutput(`terminal@web:~$ ${command}`, "info");

          // Process command
          this.processCommand(command);

          // Clear input
          this.input.value = "";
        }

        async processCommand(command) {
          const parts = command.split(" ");
          const cmd = parts[0].toLowerCase();
          const args = parts.slice(1);

          try {
            // Show loading for system commands
            if (["ps", "top", "df", "free"].includes(cmd)) {
              this.addOutput("Loading...", "loading");

              // Simulate API call to backend
              const response = await fetch("/api/terminal", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  command,
                  args,
                  currentDir: this.currentDir,
                }),
              });

              const result = await response.json();
              this.removeLastOutput(); // Remove loading message

              if (result.success) {
                this.addOutput(result.output, "success");
                if (result.currentDir) this.currentDir = result.currentDir;
              } else {
                this.addOutput(result.error, "error");
              }
              return;
            }

            // Handle local commands
            switch (cmd) {
              case "help":
                this.showHelp();
                break;
              case "clear":
              case "cls":
                this.clearTerminal();
                break;
              case "pwd":
                this.addOutput(this.currentDir, "success");
                break;
              case "ls":
              case "dir":
                this.listDirectory(args);
                break;
              case "cd":
                this.changeDirectory(args[0] || "/home/user");
                break;
              case "mkdir":
                this.createDirectory(args[0]);
                break;
              case "touch":
                this.createFile(args[0]);
                break;
              case "cat":
              case "type":
                this.readFile(args[0]);
                break;
              case "echo":
                this.addOutput(args.join(" "), "success");
                break;
              case "whoami":
                this.addOutput("web-user@terminal-emulator", "success");
                break;
              case "history":
                this.showHistory();
                break;
              case "exit":
              case "quit":
                this.addOutput(
                  "Thanks for using Python Terminal Emulator!",
                  "info"
                );
                this.addOutput(
                  "üèÜ SRM Hacks with CodeMate Submission",
                  "success"
                );
                break;
              default:
                // Try backend for unknown commands
                const response = await fetch("/api/terminal", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    command,
                    args,
                    currentDir: this.currentDir,
                  }),
                });

                const result = await response.json();
                if (result.success) {
                  this.addOutput(result.output, "success");
                } else {
                  this.addOutput(`Command not found: ${cmd}`, "error");
                  this.addOutput('Type "help" for available commands.', "info");
                }
            }
          } catch (error) {
            this.addOutput(
              `Error executing command: ${error.message}`,
              "error"
            );
          }
        }

        showHelp() {
          const helpText = `
üîß Available Commands:

üìÅ File Operations:
  ls, dir          - List directory contents
  cd <path>        - Change directory
  pwd              - Show current directory
  mkdir <name>     - Create directory
  touch <file>     - Create empty file
  cat, type <file> - Display file contents

üíª System Commands:
  ps               - List running processes
  top              - Show system resources
  df               - Show disk usage
  free             - Show memory usage
  whoami           - Show current user

üõ†Ô∏è Built-in Commands:
  help             - Show this help
  history          - Show command history
  clear, cls       - Clear screen
  echo <text>      - Display text
  exit, quit       - Exit terminal

üéØ This terminal emulator supports real system monitoring via Python backend!
üèÜ Built for SRM Hacks with CodeMate Competition
                `;
          this.addOutput(helpText, "info");
        }

        listDirectory(args) {
          const current = this.getCurrentDirectory();
          if (!current || current.type !== "directory") {
            this.addOutput("Not a directory", "error");
            return;
          }

          const showDetails = args.includes("-l") || args.includes("-la");
          let output = "";

          for (const [name, item] of Object.entries(current.contents)) {
            if (showDetails) {
              const type = item.type === "directory" ? "d" : "-";
              const perms =
                item.type === "directory" ? "rwxr-xr-x" : "rw-r--r--";
              const size = item.content ? item.content.length : 0;
              output += `${type}${perms} 1 user user ${size
                .toString()
                .padStart(8)} Dec 21 10:30 ${name}\n`;
            } else {
              output += item.type === "directory" ? `${name}/\n` : `${name}\n`;
            }
          }

          this.addOutput(output || "Directory is empty", "success");
        }

        getCurrentDirectory() {
          const parts = this.currentDir.split("/").filter((p) => p);
          let current = this.fileSystem["/home/user"];

          for (const part of parts.slice(2)) {
            // Skip 'home/user'
            if (current && current.contents && current.contents[part]) {
              current = current.contents[part];
            } else {
              return null;
            }
          }
          return current;
        }

        changeDirectory(path) {
          if (!path || path === "~") {
            this.currentDir = "/home/user";
            return;
          }

          if (path === "..") {
            const parts = this.currentDir.split("/").filter((p) => p);
            if (parts.length > 2) {
              parts.pop();
              this.currentDir = "/" + parts.join("/");
            }
            return;
          }

          // Simple path resolution
          const newPath = path.startsWith("/")
            ? path
            : `${this.currentDir}/${path}`;
          this.currentDir = newPath;
          this.addOutput(`Changed directory to: ${this.currentDir}`, "success");
        }

        createDirectory(name) {
          if (!name) {
            this.addOutput("mkdir: missing directory name", "error");
            return;
          }
          this.addOutput(`Directory '${name}' created successfully`, "success");
        }

        createFile(name) {
          if (!name) {
            this.addOutput("touch: missing file name", "error");
            return;
          }
          this.addOutput(`File '${name}' created successfully`, "success");
        }

        readFile(name) {
          if (!name) {
            this.addOutput("cat: missing file name", "error");
            return;
          }

          const current = this.getCurrentDirectory();
          if (current && current.contents && current.contents[name]) {
            const file = current.contents[name];
            if (file.type === "file") {
              this.addOutput(file.content, "success");
            } else {
              this.addOutput(`cat: ${name}: Is a directory`, "error");
            }
          } else {
            this.addOutput(`cat: ${name}: No such file or directory`, "error");
          }
        }

        showHistory() {
          if (this.history.length === 0) {
            this.addOutput("No command history", "info");
            return;
          }

          let output = "";
          this.history.forEach((cmd, index) => {
            output += `${(index + 1).toString().padStart(4)}: ${cmd}\n`;
          });
          this.addOutput(output, "success");
        }

        navigateHistory(direction) {
          if (this.history.length === 0) return;

          this.historyIndex += direction;

          if (this.historyIndex < 0) {
            this.historyIndex = 0;
          } else if (this.historyIndex >= this.history.length) {
            this.historyIndex = this.history.length;
            this.input.value = "";
            return;
          }

          this.input.value = this.history[this.historyIndex] || "";
        }

        addOutput(text, className = "") {
          const output = document.createElement("div");
          output.className = `output ${className}`;
          output.textContent = text;
          this.terminal.appendChild(output);
          this.terminal.scrollTop = this.terminal.scrollHeight;
        }

        removeLastOutput() {
          const outputs = this.terminal.querySelectorAll(".output");
          if (outputs.length > 0) {
            outputs[outputs.length - 1].remove();
          }
        }

        clearTerminal() {
          this.terminal.innerHTML = `
                    <div class="output info">
üéÆ Python Terminal Emulator v1.0 - Web Edition
üíª Built for SRM Hacks with CodeMate Competition
üìç Current Directory: ${this.currentDir}
üöÄ Ready for commands! Type 'help' for available commands.
                    </div>
                `;
        }
      }

      // Initialize terminal when page loads
      document.addEventListener("DOMContentLoaded", () => {
        new WebTerminal();
      });
    </script>
  </body>
</html>
